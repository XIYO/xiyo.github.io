echo "ğŸš€ Running pre-push checks..."

# ë¸Œëœì¹˜ ì •ë³´ í™•ì¸
protected_branch="main"
current_branch=$(git branch --show-current)

echo "ğŸ“ Current branch: $current_branch"

# main ë¸Œëœì¹˜ë¡œ pushí•  ë•ŒëŠ” ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
if [ "$current_branch" = "$protected_branch" ]; then
  echo "âš ï¸  Pushing to protected branch '$protected_branch' - running full test suite..."
  
  echo "ğŸ§ª Running unit tests..."
  if ! pnpm test:unit; then
    echo "âŒ Unit tests failed. Push aborted."
    exit 1
  fi

  echo "ğŸ”¨ Building project..."
  if ! pnpm build --logLevel silent; then
    echo "âŒ Build failed. Push aborted."
    exit 1
  fi

  echo "ğŸ­ Running E2E tests..."
  if ! pnpm test:e2e; then
    echo "âŒ E2E tests failed. Push aborted."
    exit 1
  fi

  echo "âœ… All tests passed for $protected_branch branch!"
else
  # ë‹¤ë¥¸ ë¸Œëœì¹˜ëŠ” ë¹ ë¥¸ ì²´í¬ë§Œ
  echo "ğŸ” Running quick checks for feature branch..."
  
  echo "ğŸ§ª Running unit tests..."
  if ! pnpm test:unit; then
    echo "âŒ Unit tests failed. Push aborted."
    exit 1
  fi

  echo "ğŸ”¨ Building project..."
  if ! pnpm build --logLevel silent; then
    echo "âŒ Build failed. Push aborted."
    exit 1
  fi

  echo "âœ… Quick checks passed for branch '$current_branch'!"
fi

echo "ğŸ‰ Pre-push validation complete. Proceeding with push..."