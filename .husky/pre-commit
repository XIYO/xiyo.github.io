echo "ğŸ” Running pre-commit checks..."

# 1. Prettierë¡œ í¬ë§· ì²´í¬
echo "ğŸ“ Checking code formatting..."
if ! pnpm lint; then
  echo "âŒ Code formatting check failed. Run 'pnpm format' to fix."
  exit 1
fi

# 2. TypeScript/Svelte íƒ€ì… ì²´í¬ (ì„ì‹œë¡œ ë¹„í™œì„±í™”)
echo "ğŸ”§ Skipping type check for testing..."
# if ! pnpm check; then
#   echo "âŒ Type check failed. Please fix the errors above."
#   exit 1
# fi

# 3. ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì— ê¸°ë³¸ frontmatter ì¶”ê°€
echo "ğŸ“ Adding basic frontmatter to blog posts..."

STAGED_MD=$(git diff --cached --name-only --diff-filter=ACM | grep '^static/posts/.*\.md$' || true)

if [ -n "$STAGED_MD" ]; then
  for file in $STAGED_MD; do
    if [ -f "$file" ] && ! grep -q "^---" "$file"; then
      echo "  ğŸ“„ Processing: $file"
      if pnpm exec node scripts/add-basic-frontmatter.js "$file"; then
        git add "$file"
        echo "  âœ… Added frontmatter to $file"
      else
        echo "  âŒ Failed to process $file"
        exit 1
      fi
    elif [ -f "$file" ]; then
      echo "  â© $file already has frontmatter"
    else
      echo "  â© $file does not exist (deleted)"
    fi
  done
else
  echo "  â„¹ï¸  No blog post files to process"
fi

echo "âœ… All pre-commit checks passed!"