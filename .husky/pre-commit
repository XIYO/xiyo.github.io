# ë³€ê²½ëœ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ì°¾ê¸°
changed_md_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(md|markdown)$' || true)

# ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ì²˜ë¦¬
if [ -n "$changed_md_files" ]; then
  echo "ğŸ”„ ë³€ê²½ëœ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì˜ í”„ë¡ íŠ¸ë§¤í„°ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤..."
  
  # ë³€ê²½ëœ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ë“¤ì˜ í”„ë¡ íŠ¸ë§¤í„° ì—…ë°ì´íŠ¸
  for file in $changed_md_files; do
    if [ -f "$file" ]; then
      echo "  ğŸ“ $file"
      node scripts/clean-frontmatter.js "$file"
    fi
  done
  
  # ì—…ë°ì´íŠ¸ëœ íŒŒì¼ë“¤ì„ ë‹¤ì‹œ ìŠ¤í…Œì´ì§•
  for file in $changed_md_files; do
    if [ -f "$file" ]; then
      git add "$file"
    fi
  done
  
  echo "âœ… í”„ë¡ íŠ¸ë§¤í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ!"
fi

# ë³€ê²½ëœ ì½”ë“œ íŒŒì¼ ì°¾ê¸° (js, ts, svelte, css, html ë“±)
changed_code_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|svelte|css|html|json)$' || true)

# ì½”ë“œ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ í¬ë§·íŒ…ê³¼ ë¦°íŠ¸ ì‹¤í–‰
if [ -n "$changed_code_files" ] || [ -n "$changed_md_files" ]; then
  echo "ğŸ¨ ì½”ë“œ í¬ë§·íŒ…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤..."
  pnpm format
  
  # ë‹¤ì‹œ ìŠ¤í…Œì´ì§• (í¬ë§·íŒ… í›„ ë³€ê²½ëœ íŒŒì¼ë“¤)
  git add .
  
  echo "ğŸ” ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..."
  pnpm lint
else
  echo "ğŸ“ ë³€ê²½ëœ íŒŒì¼ì´ ì—†ì–´ í¬ë§·íŒ…ê³¼ ë¦°íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤."
fi
