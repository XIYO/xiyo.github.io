#!/bin/sh

# μ»¤λ°‹ λ©”μ‹μ§€ νμΌ κ²½λ΅
commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# μλ™ μ»¤λ°‹ λ©”μ‹μ§€μΈμ§€ ν™•μΈ (λ¬΄ν•λ£¨ν”„ λ°©μ§€)
if [[ "$commit_msg" == *"[AUTO]"* ]]; then
  exit 0
fi

# μ΄λ² μ»¤λ°‹μ—μ„ λ³€κ²½λ λ§ν¬λ‹¤μ΄ νμΌ μ°ΎκΈ°
changed_md_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(md|markdown)$' || true)

# λ§ν¬λ‹¤μ΄ νμΌμ΄ λ³€κ²½λ κ²½μ°μ—λ§ ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ
if [ -n "$changed_md_files" ]; then
  echo "π”„ μ»¤λ°‹ λ©”μ‹μ§€ ν™•μ • ν›„ ν”„λ΅ νΈλ§¤ν„°λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤..."
  
  # λ³€κ²½λ λ§ν¬λ‹¤μ΄ νμΌλ“¤μ ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ
  for file in $changed_md_files; do
    if [ -f "$file" ]; then
      echo "  π“ $file (μ»¤λ°‹ λ©”μ‹μ§€: $commit_msg)"
      HUSKY_COMMIT_MSG="$commit_msg" node scripts/clean-frontmatter.js "$file"
    fi
  done
  
  # μ—…λ°μ΄νΈλ νμΌλ“¤μ„ λ‹¤μ‹ μ¤ν…μ΄μ§•
  for file in $changed_md_files; do
    if [ -f "$file" ]; then
      git add "$file"
    fi
  done
  
  echo "β… ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ μ™„λ£!"
fi
