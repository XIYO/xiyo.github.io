#!/bin/sh

# μλ™ μ»¤λ°‹ λ©”μ‹μ§€μΈμ§€ ν™•μΈ (λ¬΄ν•λ£¨ν”„ λ°©μ§€)
commit_message=$(git log -1 --pretty=%B)
if [[ "$commit_message" == *"[AUTO] ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ"* ]]; then
  echo "π« μλ™ μ»¤λ°‹μ΄λ―€λ΅ ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈλ¥Ό κ±΄λ„λλ‹λ‹¤."
  exit 0
fi

# λ§μ§€λ§‰ μ»¤λ°‹μ—μ„ λ³€κ²½λ λ§ν¬λ‹¤μ΄ νμΌ μ°ΎκΈ°
changed_md_files=$(git diff --name-only HEAD~1 HEAD | grep -E '\.(md|markdown)$' || true)

# λ§ν¬λ‹¤μ΄ νμΌμ΄ λ³€κ²½λ κ²½μ°μ—λ§ ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ
if [ -n "$changed_md_files" ]; then
  echo "π”„ μ»¤λ°‹ μ™„λ£ ν›„ ν”„λ΅ νΈλ§¤ν„°λ¥Ό μ—…λ°μ΄νΈν•©λ‹λ‹¤..."
  
  # λ³€κ²½λ λ§ν¬λ‹¤μ΄ νμΌλ“¤μ ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ
  for file in $changed_md_files; do
    if [ -f "$file" ]; then
      echo "  π“ $file"
      node scripts/clean-frontmatter.js "$file"
    fi
  done
  
  # λ³€κ²½μ‚¬ν•­μ΄ μλ”μ§€ ν™•μΈ
  if ! git diff --quiet; then
    echo "β… ν”„λ΅ νΈλ§¤ν„°κ°€ μ—…λ°μ΄νΈλμ–΄ μ¶”κ°€ μ»¤λ°‹μ„ μƒμ„±ν•©λ‹λ‹¤..."
    git add .
    git commit -m "[AUTO] ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈ - μ»¤λ°‹ μ΄λ ¥ λ™κΈ°ν™”"
  else
    echo "π“ ν”„λ΅ νΈλ§¤ν„°μ— λ³€κ²½μ‚¬ν•­μ΄ μ—†μµλ‹λ‹¤."
  fi
else
  echo "π“ λ³€κ²½λ λ§ν¬λ‹¤μ΄ νμΌμ΄ μ—†μ–΄ ν”„λ΅ νΈλ§¤ν„° μ—…λ°μ΄νΈλ¥Ό κ±΄λ„λλ‹λ‹¤."
fi
